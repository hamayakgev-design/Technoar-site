<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Technoar¬Æ ‚Äì Pro Catalog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #e5e7f1;
      --card-bg: #f9fafb;
      --border: #d1d5db;
      --text-main: #0f172a;
      --text-muted: #6b7280;
      --accent: #2563eb;
      --radius-lg: 12px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at 0% 0%, #eef2ff, #e5e7eb);
      color: var(--text-main);
    }

    .page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background: linear-gradient(90deg, #1d4ed8, #0ea5e9);
      border-bottom: none;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      position: sticky;
      top: 0;
      z-index: 10;
      box-shadow: 0 14px 32px rgba(15, 23, 42, 0.35);
      color: #f9fafb;
    }

    header h1 {
      font-size: 16px;
      margin: 0;
      font-weight: 600;
    }

    .btn-back {
      font-size: 12px;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid rgba(248, 250, 252, 0.7);
      background: rgba(248, 250, 252, 0.15);
      cursor: pointer;
      color: #f9fafb;
      backdrop-filter: blur(8px);
      transition: background 0.15s ease, transform 0.1s ease,
        box-shadow 0.15s ease, border-color 0.15s ease;
    }

    .btn-back:hover {
      background: rgba(248, 250, 252, 0.28);
      border-color: #ffffff;
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.45);
    }

    .content {
      max-width: 960px;
      margin: 16px auto 32px;
      padding: 16px;
      width: 100%;
      background: rgba(249, 250, 251, 0.92);
      border-radius: 20px;
      box-shadow: 0 24px 40px rgba(15, 23, 42, 0.16);
      border: 1px solid rgba(148, 163, 184, 0.4);
    }

    .toolbar-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 16px;
    }

    .breadcrumbs {
      font-size: 12px;
      color: var(--text-muted);
    }

    .brand-selector-wrap {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
    }

    .brand-selector-wrap label {
      color: var(--text-muted);
      white-space: nowrap;
    }

    select#brandSelector {
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #ffffff;
      max-width: 180px;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease,
        background 0.15s ease;
    }

    select#brandSelector:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.35);
      background: #f9fafb;
    }

    .btn-info-toggle {
      font-size: 12px;
      padding: 4px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #ffffff;
      cursor: pointer;
      white-space: nowrap;
      color: var(--text-main);
      transition: background 0.15s ease, color 0.15s ease,
        border-color 0.15s ease, box-shadow 0.15s ease, transform 0.1s ease;
    }

    .btn-info-toggle:hover {
      border-color: var(--accent);
      box-shadow: 0 8px 16px rgba(15, 23, 42, 0.14);
      transform: translateY(-1px);
    }

    .btn-info-toggle.active {
      background: #000000;
      color: #ffffff;
      border-color: #000000;
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.35);
    }

    h2 {
      font-size: 18px;
      margin: 0 0 8px;
    }

    h3 {
      margin: 0;
    }

    .section-title {
      font-size: 14px;
      margin-top: 24px;
      margin-bottom: 8px;
      text-transform: lowercase;
      color: var(--text-main);
    }

    .section-title::first-letter {
      text-transform: uppercase;
    }

    .brand-cards {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    @media (min-width: 640px) {
      .brand-cards {
        flex-direction: row;
      }
    }

    .brand-card {
      flex: 1;
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      padding: 16px;
      cursor: pointer;
      transition: box-shadow 0.18s ease, transform 0.1s ease,
        border-color 0.18s ease, background 0.18s ease;
    }

    .brand-card:hover {
      box-shadow: 0 14px 28px rgba(15, 23, 42, 0.16);
      transform: translateY(-2px);
      border-color: rgba(37, 99, 235, 0.5);
      background: #f3f4ff;
    }

    .brand-card-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .brand-card-desc {
      font-size: 13px;
      color: var(--text-muted);
    }

    .product-section {
      margin-bottom: 24px;
    }

    .product-card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      padding: 12px;
      display: flex;
      gap: 12px;
      align-items: center;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.08);
      transition: transform 0.12s ease, box-shadow 0.15s ease,
        border-color 0.15s ease, background 0.15s ease;
    }

    .product-card + .product-card {
      margin-top: 8px;
    }

    .product-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 16px 30px rgba(15, 23, 42, 0.18);
      border-color: rgba(37, 99, 235, 0.45);
      background: #f3f4fd;
    }

    .product-image-wrap {
      flex: 0 0 120px;
      max-width: 160px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 6px;
      background: #e5e7f5;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.6);
    }

    .product-image {
      max-width: 100%;
      max-height: 120px;
      border-radius: 8px;
      object-fit: contain;
    }

    .product-info {
      flex: 1;
      min-width: 0;
    }

    .product-name {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .product-meta {
      font-size: 13px;
      color: var(--text-main);
      margin-bottom: 2px;
    }

    .product-more {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 2px;
    }

    .product-code {
      font-size: 11px;
      color: var(--text-muted);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
    }

    .hint {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .info-block-divider {
      border-top: 1px dashed var(--border);
      margin: 24px 0 16px;
    }

    .info-block-label {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    /* üëá ’∏÷Ä’§’ß’Ω view switch’ù ÷Å’∏÷Ç÷Å’°’§÷Ä’•’¨’∏÷Ç / ’©’°÷Ñ÷Å’∂’•’¨’∏÷Ç ’∞’°’¥’°÷Ä */
    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1>Technoar¬Æ ‚Äì Pro Catalog</h1>
      <button class="btn-back" id="btnBackIndex">Back to index</button>
    </header>

    <main class="content">
      <div class="toolbar-row">
        <div class="breadcrumbs" id="breadcrumbs">All brands</div>
        <div class="brand-selector-wrap">
          <label for="brandSelector">Brand:</label>
          <select id="brandSelector">
            <!-- options filled by JS -->
          </select>
          <button class="btn-info-toggle" id="btnToggleInfo" type="button">
            Info pages
          </button>
        </div>
      </div>

      <div id="catalogRoot"></div>

      <!-- Info pages (Contact, Materials, Technology, CAD CAM, ...) -->
      <div class="info-block-divider"></div>
      <div class="info-block-label">Additional info pages</div>
      <div id="infoPagesRoot"></div>
    </main>
  </div>

  <script>
    let CATALOG = { brands: [] };
    let activeBrandId = null; // null = "All brands"

    // brand buckets / info state
    let allBrands = [];
    let normalBrands = [];
    let infoPages = [];
    let showInfoPages = false;

    // names used as "info pages" (lowercase)
    const INFO_PAGE_NAMES = ["contact", "materials", "technology", "cad cam"];

    const catalogRootEl = document.getElementById("catalogRoot");
    const infoPagesRootEl = document.getElementById("infoPagesRoot");
    const breadcrumbsEl = document.getElementById("breadcrumbs");
    const brandSelectEl = document.getElementById("brandSelector");
    const btnBackIndex = document.getElementById("btnBackIndex");
    const btnToggleInfo = document.getElementById("btnToggleInfo");
    const infoDividerEl = document.querySelector(".info-block-divider");
    const infoLabelEl = document.querySelector(".info-block-label");

    function escapeHtml(str) {
      if (str == null) return "";
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function normalizeBrandName(name) {
      return (name || "")
        .toLowerCase()
        .trim()
        .replace(/\s+/g, " ");
    }

    function rebuildBrandBuckets() {
      allBrands = CATALOG.brands || [];
      normalBrands = [];
      infoPages = [];

      allBrands.forEach(function (b) {
        const nm = normalizeBrandName(b.name || "");
        if (INFO_PAGE_NAMES.indexOf(nm) !== -1) {
          infoPages.push(b); // Contact / Materials / Technology / CAD CAM ...
        } else {
          normalBrands.push(b); // real implant brands
        }
      });
    }

    function findBrand(id) {
      return (allBrands || []).find(function (b) {
        return b.id === id;
      }) || null;
    }

    // ---------- Brand selector (dropdown) ----------
    function renderBrandSelector() {
      if (!brandSelectEl) return;
      const brands = normalBrands || [];
      let html = '<option value="">All brands</option>';

      brands.forEach(function (b) {
        const id = b.id || "";
        const selected = id && id === activeBrandId ? " selected" : "";
        html +=
          '<option value="' +
          escapeHtml(id) +
          '"' +
          selected +
          ">" +
          escapeHtml(b.name || "(no name)") +
          "</option>";
      });

      brandSelectEl.innerHTML = html;
      brandSelectEl.value = activeBrandId || "";
    }

    function renderBreadcrumbs() {
      if (!breadcrumbsEl) return;
      if (showInfoPages) {
        breadcrumbsEl.textContent = "Info pages";
        return;
      }
      if (!activeBrandId) {
        breadcrumbsEl.textContent = "All brands";
      } else {
        const brand = findBrand(activeBrandId);
        if (!brand) {
          breadcrumbsEl.textContent = "All brands";
        } else {
          breadcrumbsEl.textContent = "All brands ¬∑ " + (brand.name || "");
        }
      }
    }

    // ---------- Catalog rendering (brands only) ----------
    function renderCatalog() {
      if (!catalogRootEl) return;

      const brands = normalBrands || [];

      if (!brands.length) {
        catalogRootEl.innerHTML =
          '<p class="hint">No brands in catalog.json yet.</p>';
        return;
      }

      // All brands view
      if (!activeBrandId) {
        let html = "";
        html += "<h2>All brands</h2>";
        html +=
          '<p class="hint">Select implant system</p><div class="brand-cards">';

        brands.forEach(function (b) {
          html +=
            '<div class="brand-card" data-brand-id="' +
            escapeHtml(b.id || "") +
            '">';
          html +=
            '<div class="brand-card-title">' +
            escapeHtml(b.name || "(no name)") +
            "</div>";
          html +=
            '<div class="brand-card-desc">' +
            escapeHtml(b.description || "Click to open products") +
            "</div>";
          html += "</div>";
        });

        html += "</div>";
        catalogRootEl.innerHTML = html;

        const cards = catalogRootEl.querySelectorAll(".brand-card");
        cards.forEach(function (card) {
          card.addEventListener("click", function () {
            const id = card.getAttribute("data-brand-id");
            if (!id) return;
            activeBrandId = id;
            renderBrandSelector();
            renderBreadcrumbs();
            renderCatalog();
          });
        });

        return;
      }

      // Single brand view
      const brand = findBrand(activeBrandId);
      if (!brand) {
        activeBrandId = null;
        renderBrandSelector();
        renderBreadcrumbs();
        renderCatalog();
        return;
      }

      let html = "";
      html += "<h2>" + escapeHtml(brand.name || "") + "</h2>";

      if (brand.description) {
        html +=
          '<p class="hint">' + escapeHtml(brand.description) + "</p>";
      }

      if (!brand.sections || !brand.sections.length) {
        html +=
          '<p class="hint">No sections for this brand yet.</p>';
        catalogRootEl.innerHTML = html;
        return;
      }

      brand.sections.forEach(function (section) {
        html += '<div class="product-section">';
        html +=
          '<div class="section-title">' +
          escapeHtml(section.title || "") +
          "</div>";

        if (!section.products || !section.products.length) {
          html +=
            '<p class="hint">No products in this section yet.</p>';
        } else {
          section.products.forEach(function (p) {
            html += '<div class="product-card">';

            html += '<div class="product-image-wrap">';
            if (p.imageUrl) {
              html +=
                '<img class="product-image" src="' +
                escapeHtml(p.imageUrl) +
                '" alt="' +
                escapeHtml(p.name || "") +
                '">';
            } else {
              html +=
                '<span style="font-size:11px;color:#999;">No image</span>';
            }
            html += "</div>";

            html += '<div class="product-info">';
            html +=
              '<div class="product-name">' +
              escapeHtml(p.name || "") +
              "</div>";
            if (p.meta) {
              html +=
                '<div class="product-meta">' +
                escapeHtml(p.meta) +
                "</div>";
            }
            if (p.more) {
              html +=
                '<div class="product-more">' +
                escapeHtml(p.more) +
                "</div>";
            }
            if (p.code) {
              html +=
                '<div class="product-code">' +
                escapeHtml(p.code) +
                "</div>";
            }
            html += "</div>";

            html += "</div>";
          });
        }

        html += "</div>";
      });

      catalogRootEl.innerHTML = html;
    }

    // ---------- Info pages rendering (Contact, Materials, CAD CAM, ...) ----------
    function renderInfoPages() {
      if (!infoPagesRootEl) return;

      // OFF state ’Ø’°’¥ info ’π’Ø’°’∂ ‚Üí ’©’°÷Ñ÷Å’∂’∏÷Ç’¥ ’•’∂÷Ñ info view, ÷Å’∏÷Ç’µ÷Å ’•’∂÷Ñ ’ø’°’¨’´’Ω brands
      if (!showInfoPages || !infoPages.length) {
        infoPagesRootEl.innerHTML = "";

        if (infoDividerEl) infoDividerEl.classList.add("hidden");
        if (infoLabelEl) infoLabelEl.classList.add("hidden");
        if (catalogRootEl) catalogRootEl.classList.remove("hidden");
        if (brandSelectEl) brandSelectEl.disabled = false;

        if (btnToggleInfo) {
          btnToggleInfo.classList.remove("active");
          btnToggleInfo.textContent = "Info pages";
        }

        renderBreadcrumbs();
        return;
      }

      // ON state ‚Üí ’Æ’°’Æ’Ø’∏÷Ç’¥ ’•’∂÷Ñ brands, ÷Å’∏÷Ç’µ÷Å ’•’∂÷Ñ ’ø’°’¨’´’Ω ’¥’´’°’µ’∂ info pages
      if (infoDividerEl) infoDividerEl.classList.remove("hidden");
      if (infoLabelEl) infoLabelEl.classList.remove("hidden");
      if (catalogRootEl) catalogRootEl.classList.add("hidden");
      if (brandSelectEl) brandSelectEl.disabled = true;

      renderBreadcrumbs(); // breadcrumbs = "Info pages"

      let html = "";

      infoPages.forEach(function (brand) {
        html += '<section class="product-section">';
        html += "<h2>" + escapeHtml(brand.name || "") + "</h2>";

        if (brand.description) {
          html +=
            '<p class="hint">' + escapeHtml(brand.description) + "</p>";
        }

        if (!brand.sections || !brand.sections.length) {
          html +=
            '<p class="hint">No sections for this page yet.</p>';
        } else {
          brand.sections.forEach(function (section) {
            html += '<div class="product-section">';
            html +=
              '<div class="section-title">' +
              escapeHtml(section.title || "") +
              "</div>";

            if (!section.products || !section.products.length) {
              html +=
                '<p class="hint">No products in this section yet.</p>';
            } else {
              section.products.forEach(function (p) {
                html += '<div class="product-card">';

                html += '<div class="product-image-wrap">';
                if (p.imageUrl) {
                  html +=
                    '<img class="product-image" src="' +
                    escapeHtml(p.imageUrl) +
                    '" alt="' +
                    escapeHtml(p.name || "") +
                    '">';
                } else {
                  html +=
                    '<span style="font-size:11px;color:#999;">No image</span>';
                }
                html += "</div>";

                html += '<div class="product-info">';
                html +=
                  '<div class="product-name">' +
                  escapeHtml(p.name || "") +
                  "</div>";
                if (p.meta) {
                  html +=
                    '<div class="product-meta">' +
                    escapeHtml(p.meta) +
                    "</div>";
                }
                if (p.more) {
                  html +=
                    '<div class="product-more">' +
                    escapeHtml(p.more) +
                    "</div>";
                }
                if (p.code) {
                  html +=
                    '<div class="product-code">' +
                    escapeHtml(p.code) +
                    "</div>";
                }
                html += "</div>";

                html += "</div>";
              });
            }

            html += "</div>";
          });
        }

        html += "</section>";
      });

      infoPagesRootEl.innerHTML = html;

      if (btnToggleInfo) {
        btnToggleInfo.classList.add("active");
        btnToggleInfo.textContent = "Hide info pages";
      }
    }

    // ---------- Data load ----------
    function loadCatalog() {
      return fetch("catalog.json")
        .then(function (res) {
          return res.json();
        })
        .then(function (data) {
          CATALOG = data || { brands: [] };
          rebuildBrandBuckets();
        })
        .catch(function () {
          CATALOG = { brands: [] };
          rebuildBrandBuckets();
        });
    }

    // ---------- Init ----------
    (function init() {
      if (btnBackIndex) {
        btnBackIndex.addEventListener("click", function () {
          activeBrandId = null;
          showInfoPages = false;
          renderBrandSelector();
          renderBreadcrumbs();
          renderCatalog();
          renderInfoPages();
        });
      }

      if (brandSelectEl) {
        brandSelectEl.addEventListener("change", function () {
          const val = brandSelectEl.value;
          activeBrandId = val || null;
          showInfoPages = false; // ’•’©’• brand ’•’∂÷Ñ ’®’∂’ø÷Ä’∏÷Ç’¥, ’§’∏÷Ç÷Ä’Ω ’•’∂÷Ñ ’£’°’¨’´’Ω info view-’´÷Å
          renderBreadcrumbs();
          renderCatalog();
          renderInfoPages();
        });
      }

      if (btnToggleInfo) {
        btnToggleInfo.addEventListener("click", function () {
          showInfoPages = !showInfoPages;
          renderInfoPages();
        });
      }

      loadCatalog().then(function () {
        renderBrandSelector();
        renderBreadcrumbs();
        renderCatalog();
        renderInfoPages(); // initial (hidden)
      });
    })();
  </script>
</body>
</html>
